{% extends "base.html" %}
{% block content %}
<h1 class="display-1 text-center"><strong>Results</strong></h1>
<div id="results"></div>
<div class="row">
    <div class="col-md text-center">
        <a href="/" role="button">Go back</a>
    </div>
</div>

<script>
    var urls = [{% for result in data %}"{{ result }}"{% if not loop.last %},{% endif %}{% endfor %}];
    var counter = 1

    function parseLyrics(i, urls, all_lyrics) {
        counter++;
        data = {
            total_count: {{ data|length }},
            completed: counter,
            all_lyrics: all_lyrics,
            url: urls[i]
        };

        $.getJSON("{{ url_for('parse') }}", data, function(result) {
            var output = $("#results");
            output.html(result["html"]);

            lyrics = result["all_lyrics"];

            if ((i + 1) < urls.length) {
                parseLyrics(i + 1, urls, lyrics);
            }
        });
    }

    $(document).ready(function() {
        parseLyrics(1, urls, null);
    });
</script>
{% endblock %}